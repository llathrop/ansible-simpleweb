# Single-container mode: only the web app (no MongoDB, agent, workers).
# Use this for base install or when building the distributable image.
# Optional services can be added later via config + Ansible (see docs/PHASE_SINGLE_CONTAINER_BOOTSTRAP.md).
#
# Usage:
#   docker compose -f docker-compose.single.yml up -d
#   # Or build: docker compose -f docker-compose.single.yml up -d --build

services:
  ansible-web:
    build: .
    container_name: ansible-simpleweb
    ports:
      - "3001:3001"
    volumes:
      - ./playbooks:/app/playbooks
      - ./logs:/app/logs
      - ./inventory:/app/inventory
      - ./web:/app/web
      - ./config:/app/config
      - ./library:/app/library
      - ./callback_plugins:/app/callback_plugins
      - ./ansible.cfg:/app/ansible.cfg
      - ./.ssh:/app/.ssh:ro
      - ~/.ssh:/root/.ssh:ro
      - ./ssh-keys:/app/ssh-keys
    environment:
      - FLASK_ENV=development
      - FLASK_APP=web/app.py
      - STORAGE_BACKEND=flatfile
      - CLUSTER_MODE=standalone
      - REGISTRATION_TOKEN=
      - CHECKIN_INTERVAL=60
      - LOCAL_WORKER_TAGS=local
    # No depends_on: runs alone
    restart: unless-stopped
